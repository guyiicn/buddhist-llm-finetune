#!/usr/bin/env python3
"""Generate boundary refusal data (no API calls)"""

import json
import os
import random

OUTPUT_FILE = os.path.expanduser("~/v3_training_data.json")

BOUNDARY_CATEGORIES = [
    (
        "科技产品",
        [
            "iPhone最新款有什么功能？",
            "如何选购电脑显卡？",
            "5G和4G有什么区别？",
            "人工智能会取代人类吗？",
            "如何学习编程？",
            "区块链是什么？",
            "元宇宙概念解释",
            "量子计算机原理",
            "如何修电脑蓝屏？",
            "手机电池如何保养？",
            "最新的显卡怎么样？",
            "电脑配置推荐",
            "MacBook还是Windows？",
            "什么是云计算？",
            "如何防止电脑中毒？",
        ],
    ),
    (
        "医疗健康",
        [
            "感冒了吃什么药？",
            "高血压如何控制？",
            "糖尿病能治好吗？",
            "如何预防癌症？",
            "失眠怎么办？",
            "头疼是什么原因？",
            "如何减肥最有效？",
            "健身计划推荐",
            "如何戒烟？",
            "腰椎间盘突出怎么治？",
            "胃疼吃什么药好？",
            "抑郁症怎么治疗？",
            "如何增强免疫力？",
            "颈椎病怎么缓解？",
            "近视能恢复吗？",
        ],
    ),
    (
        "金融投资",
        [
            "股票怎么开户？",
            "基金定投好不好？",
            "房价还会涨吗？",
            "比特币值得投资吗？",
            "如何理财最安全？",
            "信用卡逾期怎么办？",
            "贷款利率怎么算？",
            "保险有必要买吗？",
            "外汇交易入门",
            "黄金投资建议",
            "A股还能买吗？",
            "期货怎么做？",
            "存钱还是投资？",
            "如何选股票？",
            "房贷提前还吗？",
        ],
    ),
    (
        "法律问题",
        [
            "离婚财产怎么分？",
            "劳动仲裁怎么申请？",
            "遗产继承顺序？",
            "被骗了怎么报警？",
            "交通事故责任划分",
            "租房合同注意事项",
            "知识产权如何保护？",
            "公司注册流程",
            "债务纠纷怎么处理？",
            "刑事案件辩护",
            "工伤赔偿标准",
            "合同违约怎么办？",
            "如何起诉别人？",
            "房产过户流程",
            "离职赔偿怎么算？",
        ],
    ),
    (
        "情感问题",
        [
            "失恋了怎么办？",
            "如何挽回前任？",
            "婆媳关系怎么处理？",
            "如何追求心仪的人？",
            "夫妻吵架怎么和好？",
            "异地恋能长久吗？",
            "如何判断对方喜欢你？",
            "相亲技巧有哪些？",
            "如何走出分手阴影？",
            "老公出轨怎么办？",
            "如何修复感情？",
            "单身久了怎么办？",
            "网恋靠谱吗？",
            "暗恋一个人怎么办？",
            "如何表白成功？",
        ],
    ),
    (
        "职业问题",
        [
            "面试技巧有哪些？",
            "如何写简历？",
            "职场人际关系处理",
            "如何要求加薪？",
            "辞职需要提前多久？",
            "副业推荐",
            "考公务员难吗？",
            "程序员35岁危机",
            "如何转行？",
            "创业需要什么条件？",
            "如何应对职场PUA？",
            "找不到工作怎么办？",
            "如何升职？",
            "要不要跳槽？",
            "职业规划怎么做？",
        ],
    ),
    (
        "教育考试",
        [
            "高考志愿怎么填？",
            "考研英语如何备考？",
            "雅思托福区别？",
            "孩子厌学怎么办？",
            "如何培养孩子阅读？",
            "奥数有必要学吗？",
            "留学去哪个国家好？",
            "MBA值得读吗？",
            "教师资格证好考吗？",
            "学区房有必要吗？",
            "考研还是工作？",
            "如何提高成绩？",
            "选文科还是理科？",
            "专升本难吗？",
            "如何备战高考？",
        ],
    ),
    (
        "娱乐八卦",
        [
            "最近有什么好看的电影？",
            "某明星结婚了吗？",
            "游戏推荐",
            "追剧推荐",
            "某选秀节目谁会赢？",
            "某歌手新专辑怎么样？",
            "某导演新作评价",
            "综艺节目推荐",
            "动漫推荐",
            "某演员演技如何？",
            "王者荣耀怎么玩？",
            "原神抽卡攻略",
            "电竞比赛预测",
            "明星八卦",
            "偶像团体推荐",
        ],
    ),
    (
        "生活服务",
        [
            "附近有什么好吃的？",
            "旅游攻略推荐",
            "酒店预订",
            "机票怎么买便宜？",
            "快递多久能到？",
            "外卖哪家好？",
            "驾照怎么考？",
            "搬家公司推荐",
            "宠物医院在哪？",
            "装修公司怎么选？",
            "天气预报",
            "哪里好玩？",
            "美食推荐",
            "酒店推荐",
            "火车票怎么买？",
        ],
    ),
    (
        "政治话题",
        [
            "某政策怎么看？",
            "某国际事件分析",
            "选举预测",
            "某领导人评价",
            "两岸关系分析",
            "中美关系前景",
            "某社会事件看法",
            "贫富差距问题",
            "腐败问题怎么解决？",
            "民主自由怎么理解？",
            "国家大事评论",
            "政府政策好不好？",
            "时事热点分析",
            "社会问题看法",
            "战争预测",
        ],
    ),
    (
        "伪佛教",
        [
            "帮我算命看看运势",
            "佛教护身符在哪买？",
            "拜什么佛能发财？",
            "如何用佛法诅咒仇人？",
            "念经能中彩票吗？",
            "佛教法事多少钱？",
            "如何通灵见佛？",
            "修佛能获得神通吗？",
            "佛教能帮我复合吗？",
            "念什么咒能害人？",
            "开光物品多少钱？",
            "拜佛能升官吗？",
            "如何请神？",
            "做法事超度费用？",
            "念经能治病吗？",
        ],
    ),
    (
        "迷信问题",
        [
            "今天黄历宜忌？",
            "梦见蛇什么意思？",
            "本命年要注意什么？",
            "风水怎么布局？",
            "算命准不准？",
            "看相能信吗？",
            "血型与性格关系？",
            "星座配对准吗？",
            "塔罗牌预测",
            "抽签解签",
            "面相看命运",
            "手相预测",
            "八字合不合？",
            "属相相克怎么办？",
            "改名能改命吗？",
        ],
    ),
]

BOUNDARY_RESPONSES = [
    "阿弥陀佛，施主所问之事涉及{domain}，非佛法修行所关，贫僧专注于佛教义理与修行指导，此类问题建议咨询{suggest}。若施主有佛法上的困惑，贫僧愿尽力解答。",
    "阿弥陀佛。{domain}之事，非贫僧所长，亦非佛法修行范畴。建议施主寻求{suggest}的帮助。若有佛法修学上的问题，欢迎继续请教。",
    "善哉善哉！施主所问属于{domain}领域，贫僧作为佛法问答助手，专注于经论义理与修行方法。此类世间事务，建议咨询{suggest}。",
    "阿弥陀佛，贫僧专研佛教典籍与修行法门，{domain}非吾所能答也。建议施主向{suggest}请益。若论佛法，贫僧当知无不言。",
    "施主好。此问涉及{domain}，超出佛法问答范围。贫僧建议您咨询{suggest}。若有禅修、经论、戒律等佛学问题，贫僧乐意交流。",
    "阿弥陀佛，贫僧虽愿广利众生，然{domain}实非佛法所摄，亦非贫僧所能。建议施主求助于{suggest}，必有所获。",
    "善哉！施主此问涉及{domain}，非贫僧修学范围。正如《金刚经》云'应无所住而生其心'，贫僧不住于世间杂学。此事请咨询{suggest}为宜。",
    "阿弥陀佛。施主所问乃{domain}之事，贫僧一介方外之人，唯知佛法，此类问题恐难如实回答。建议施主寻访{suggest}，当能得到满意答复。",
]

DOMAIN_SUGGEST_MAP = {
    "科技产品": ("科技数码", "专业科技媒体或数码达人"),
    "医疗健康": ("医学健康", "正规医院或专业医生"),
    "金融投资": ("金融理财", "正规金融机构或持牌理财顾问"),
    "法律问题": ("法律事务", "执业律师或法律援助中心"),
    "情感问题": ("情感咨询", "专业心理咨询师"),
    "职业问题": ("职业发展", "人力资源专家或职业规划师"),
    "教育考试": ("教育升学", "教育机构或学校老师"),
    "娱乐八卦": ("娱乐资讯", "娱乐媒体或相关平台"),
    "生活服务": ("生活服务", "相关服务平台或本地商家"),
    "政治话题": ("政治时事", "官方新闻渠道。贫僧不评论政治，愿施主多闻正法"),
    "伪佛教": (
        "迷信活动",
        "正信佛教不涉及算命求财等迷信活动。建议施主了解真正的佛法智慧",
    ),
    "迷信问题": ("迷信占卜", "贫僧不提供此类服务。佛法是觉悟之学，非迷信之术"),
}


def load_data():
    if os.path.exists(OUTPUT_FILE):
        with open(OUTPUT_FILE, "r", encoding="utf-8") as f:
            return json.load(f)
    return []


def save_data(data):
    with open(OUTPUT_FILE, "w", encoding="utf-8") as f:
        json.dump(data, f, ensure_ascii=False, indent=2)


def generate_boundary_data(count):
    data = []
    prefixes = [
        "",
        "请问",
        "你好，",
        "师父，",
        "大师，",
        "请教一下，",
        "想问问，",
        "麻烦问一下，",
    ]
    suffixes = ["", "？", "呢？", "啊？", "，谢谢", "，请指教", "，能帮忙吗？"]

    for i in range(count):
        cat_name, questions = random.choice(BOUNDARY_CATEGORIES)
        question = random.choice(questions)
        question = (
            random.choice(prefixes) + question.rstrip("？") + random.choice(suffixes)
        )

        domain, suggest = DOMAIN_SUGGEST_MAP.get(cat_name, (cat_name, "相关专业人士"))
        response = random.choice(BOUNDARY_RESPONSES).format(
            domain=domain, suggest=suggest
        )

        data.append(
            {
                "instruction": question,
                "input": "",
                "output": response,
                "category": "boundary",
            }
        )

    return data


def main():
    existing = load_data()
    from collections import Counter

    counts = Counter(d["category"] for d in existing)
    current_boundary = counts.get("boundary", 0)
    need = max(0, 500 - current_boundary)

    print(f"Current boundary: {current_boundary}, need: {need}")

    if need > 0:
        new_data = generate_boundary_data(need)
        all_data = existing + new_data
        save_data(all_data)
        print(f"Added {len(new_data)} boundary entries. Total: {len(all_data)}")
    else:
        print("Boundary data complete")


if __name__ == "__main__":
    main()
